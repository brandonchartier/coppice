{"version":3,"file":"coppice.js","sources":["../node_modules/turbodom/index.js","../src/index.js"],"sourcesContent":["export { h, patch }\n\nfunction h(tag, data) {\n  var node\n  var stack = []\n  var children = []\n\n  for (var i = arguments.length; i-- > 2; ) {\n    stack[stack.length] = arguments[i]\n  }\n\n  while (stack.length) {\n    if (Array.isArray((node = stack.pop()))) {\n      for (var i = node.length; i--; ) {\n        stack[stack.length] = node[i]\n      }\n    } else if (node != null && node !== true && node !== false) {\n      if (typeof node === \"number\") {\n        node = node + \"\"\n      }\n      children[children.length] = node\n    }\n  }\n\n  return typeof tag === \"string\"\n    ? {\n        tag: tag,\n        data: data || {},\n        children: children\n      }\n    : tag(data, children)\n}\n\nfunction patch(parent, element, oldNode, node) {\n  if (oldNode == null) {\n    element = parent.insertBefore(createElementFrom(node), element)\n  } else if (node.tag && node.tag === oldNode.tag) {\n    updateElementData(element, oldNode.data, node.data)\n\n    var len = node.children.length\n    var oldLen = oldNode.children.length\n    var reusableChildren = {}\n    var oldElements = []\n    var newKeys = {}\n\n    for (var i = 0; i < oldLen; i++) {\n      var oldElement = element.childNodes[i]\n      oldElements[i] = oldElement\n\n      var oldChild = oldNode.children[i]\n      var oldKey = getKeyFrom(oldChild)\n\n      if (null != oldKey) {\n        reusableChildren[oldKey] = [oldElement, oldChild]\n      }\n    }\n\n    var i = 0\n    var j = 0\n\n    while (j < len) {\n      var oldElement = oldElements[i]\n      var oldChild = oldNode.children[i]\n      var newChild = node.children[j]\n\n      var oldKey = getKeyFrom(oldChild)\n      if (newKeys[oldKey]) {\n        i++\n        continue\n      }\n\n      var newKey = getKeyFrom(newChild)\n\n      var reusableChild = reusableChildren[newKey] || []\n\n      if (null == newKey) {\n        if (null == oldKey) {\n          patch(element, oldElement, oldChild, newChild)\n          j++\n        }\n        i++\n      } else {\n        if (oldKey === newKey) {\n          patch(element, reusableChild[0], reusableChild[1], newChild)\n          i++\n        } else if (reusableChild[0]) {\n          element.insertBefore(reusableChild[0], oldElement)\n          patch(element, reusableChild[0], reusableChild[1], newChild)\n        } else {\n          patch(element, oldElement, null, newChild)\n        }\n\n        j++\n        newKeys[newKey] = newChild\n      }\n    }\n\n    while (i < oldLen) {\n      var oldChild = oldNode.children[i]\n      var oldKey = getKeyFrom(oldChild)\n      if (null == oldKey) {\n        removeElement(element, oldElements[i], oldChild)\n      }\n      i++\n    }\n\n    for (var i in reusableChildren) {\n      var reusableChild = reusableChildren[i]\n      var reusableNode = reusableChild[1]\n      if (!newKeys[reusableNode.data.key]) {\n        removeElement(element, reusableChild[0], reusableNode)\n      }\n    }\n  } else if (node !== oldNode) {\n    var i = element\n    parent.replaceChild((element = createElementFrom(node)), i)\n  }\n\n  return element\n}\n\nfunction merge(a, b) {\n  var obj = {}\n\n  if (typeof b !== \"object\" || Array.isArray(b)) {\n    return b\n  }\n\n  for (var i in a) {\n    obj[i] = a[i]\n  }\n  for (var i in b) {\n    obj[i] = b[i]\n  }\n\n  return obj\n}\n\nfunction createElementFrom(node, isSVG) {\n  if (typeof node === \"string\") {\n    var element = document.createTextNode(node)\n  } else {\n    var element = (isSVG = isSVG || node.tag === \"svg\")\n      ? document.createElementNS(\"http://www.w3.org/2000/svg\", node.tag)\n      : document.createElement(node.tag)\n\n    for (var i = 0; i < node.children.length; ) {\n      element.appendChild(createElementFrom(node.children[i++], isSVG))\n    }\n\n    for (var i in node.data) {\n      if (i === \"oncreate\") {\n        node.data[i](element)\n      } else {\n        setElementData(element, i, node.data[i])\n      }\n    }\n  }\n\n  return element\n}\n\nfunction setElementData(element, name, value, oldValue) {\n  if (name === \"key\") {\n  } else if (name === \"style\") {\n    for (var i in merge(oldValue, (value = value || {}))) {\n      element.style[i] = value[i] || \"\"\n    }\n  } else {\n    try {\n      element[name] = value\n    } catch (_) {}\n\n    if (typeof value !== \"function\") {\n      if (value) {\n        element.setAttribute(name, value)\n      } else {\n        element.removeAttribute(name)\n      }\n    }\n  }\n}\n\nfunction updateElementData(element, oldData, data) {\n  for (var name in merge(oldData, data)) {\n    var value = data[name]\n    var oldValue = oldData[name]\n\n    if (name === \"onupdate\") {\n      value(element)\n    } else if (value !== oldValue || value !== element[name]) {\n      setElementData(element, name, value, oldValue)\n    }\n  }\n}\n\nfunction getKeyFrom(node) {\n  if (node && (node = node.data)) {\n    return node.key\n  }\n}\n\nfunction removeElement(parent, element, node) {\n  ;((node.data && node.data.onremove) || removeChild)(element, removeChild)\n  function removeChild() {\n    parent.removeChild(element)\n  }\n}\n","import { patch, h } from 'turbodom';\n\nexport const html = h;\n\nexport const mount = (app, selector = 'body') => {\n\tdocument.querySelector(selector).appendChild(app);\n};\n\nexport const program = ({ model = {}, update = {}, view }) => {\n\tlet element, oldNode;\n\tlet root = document.createElement(null);\n\n\t// View\n\tconst render = newNode => (\n\t\telement = patch(\n\t\t\troot,\n\t\t\telement,\n\t\t\toldNode,\n\t\t\t(oldNode = newNode)\n\t\t)\n\t);\n\n\t// Update\n\tObject.keys(update).forEach(key => {\n\t\tconst msg = update[key];\n\n\t\tupdate[key] = (...payload) => {\n\t\t\tObject.assign(model, msg(\n\t\t\t\tmodel,\n\t\t\t\tupdate,\n\t\t\t\t...payload\n\t\t\t));\n\n\t\t\trender(view(model, update));\n\t\t};\n\t});\n\n\treturn render(view(model, update));\n};\n"],"names":["h","tag","data","node","stack","children","i","arguments","length","Array","isArray","pop","patch","parent","element","oldNode","insertBefore","createElementFrom","updateElementData","len","oldLen","reusableChildren","oldElements","newKeys","oldElement","childNodes","oldKey","getKeyFrom","oldChild","j","newChild","newKey","reusableChild","removeElement","reusableNode","key","replaceChild","merge","a","b","obj","isSVG","document","createTextNode","createElementNS","createElement","appendChild","setElementData","name","value","oldValue","style","_","setAttribute","removeAttribute","oldData","removeChild","onremove","const","html","mount","app","selector","querySelector","program","ref","view","root","render","newNode","Object","keys","update","forEach","msg","assign","model","payload"],"mappings":"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"}